<!DOCTYPE html> 
<html lang="ru"> 
<head> 
    <meta charset="UTF-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>WorkShift Manager | График смен и задачи сотрудников</title> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> 
    <link rel="stylesheet" href="styles.css">  <!-- Ссылка на внешний CSS -->
    <!-- Firebase SDK -->

</head> 
<body> 
    <div id="mainApp" class="container"> 
        <div class="header"> 
            <h1><i class="fas fa-calendar-alt"></i> WorkShift Manager</h1> 
            <p>Управление графиком смен, задачами и расчётом заработной платы сотрудников</p> 
        </div> 

        <div class="tabs"> 
            <button class="tab-btn active" onclick="openTab('personal')"> 
                <i class="fas fa-user"></i> Личный график 
            </button> 
            <button class="tab-btn" onclick="openTab('general')"> 
                <i class="fas fa-users"></i> Общий график 
            </button> 
            <button class="tab-btn" onclick="openTab('tasks')"> 
                <i class="fas fa-tasks"></i> Задачи 
            </button> 
            <button class="tab-btn" onclick="openTab('settings')"> 
                <i class="fas fa-cog"></i> Настройки 
            </button> 
        </div> 

        <!-- Личный график --> 
        <div id="personal" class="tab-content active"> 
            <div class="card"> 
                <h2 class="card-title"><i class="fas fa-user-plus"></i> Управление сотрудниками</h2> 
                <div class="form-row"> 
                    <div class="form-group"> 
                        <label class="form-label" for="newName">ФИО сотрудника</label> 
                        <input type="text" id="newName" class="form-control" placeholder="Иванов Иван Иванович"> 
                    </div> 
                    <div class="form-group"> 
                        <label class="form-label" for="newRate">Ставка (₽/час)</label> 
                        <input type="number" id="newRate" class="form-control" value="500" min="0" step="50"> 
                    </div> 
                    <div class="form-group d-flex align-center" style="align-self: flex-end;"> 
                        <button class="btn btn-success w-100" onclick="addEmployee()"> 
                            <i class="fas fa-plus"></i> Добавить сотрудника 
                        </button> 
                    </div> 
                </div> 
                 
                <div class="employee-list" id="employeeList"> 
                    <div class="text-center" style="padding: 40px; color: var(--text-muted);"> 
                        <i class="fas fa-users" style="font-size: 3rem; margin-bottom: 16px; opacity: 0.5;"></i> 
                        <p>Список сотрудников пуст. Добавьте первого сотрудника.</p> 
                    </div> 
                </div> 
            </div> 

            <div class="card"> 
                <h2 class="card-title"><i class="fas fa-user-edit"></i> Выбор сотрудника для просмотра</h2> 
                <div class="form-group"> 
                    <select id="employeeSelect" class="form-control"> 
                        <option value="">— Выберите сотрудника —</option> 
                    </select> 
                </div> 
            </div> 

            <div class="card"> 
                <h2 class="card-title"><i class="fas fa-calendar-week"></i> График смен</h2> 
                 
                <div class="legend"> 
                    <div class="color-item"> 
                        <div class="color-box" style="background:var(--day-shift);"></div> 
                        <span>Дневная смена (12 ч)</span> 
                    </div> 
                    <div class="color-item"> 
                        <div class="color-box" style="background:var(--night-shift);"></div> 
                        <span>Ночная смена (12 ч)</span> 
                    </div> 
                    <div class="color-item"> 
                        <div class="color-box" style="background:var(--custom-shift);"></div> 
                        <span>Индивидуальные часы</span> 
                    </div> 
                </div> 

                <div class="calendar-wrapper"> 
                    <div class="calendar"> 
                        <div class="calendar-header"> 
                            <div class="month-year"> 
                                <i class="fas fa-calendar"></i> 
                                <span id="personalMonthYear"></span> 
                            </div> 
                            <div class="nav-buttons"> 
                                <button class="btn btn-outline" onclick="prevMonth()"> 
                                    <i class="fas fa-chevron-left"></i> Предыдущий 
                                </button> 
                                <button class="btn btn-outline" onclick="goToToday()"> 
                                    <i class="fas fa-calendar-day"></i> Сегодня 
                                </button> 
                                <button class="btn btn-outline" onclick="nextMonth()"> 
                                    Следующий <i class="fas fa-chevron-right"></i> 
                                </button> 
                            </div> 
                        </div> 
                        <div class="weekdays"> 
                            <div>Понедельник</div> 
                            <div>Вторник</div> 
                            <div>Среда</div> 
                            <div>Четверг</div> 
                            <div>Пятница</div> 
                            <div>Суббота</div> 
                            <div>Воскресенье</div> 
                        </div> 
                        <div class="days" id="personalDays"></div> 
                    </div> 
                </div> 
            </div> 

            <div class="totals"> 
                <div class="total-card"> 
                    <div class="total-label">Отработано дней в месяце</div> 
                    <div class="big-number" id="personalWorkedDays">0</div> 
                    <div class="total-label-small">в текущем месяце</div> 
                </div> 
                <div class="total-card"> 
                    <div class="total-label">Отработано часов</div> 
                    <div class="big-number" id="personalTotalHours">0</div> 
                    <div class="total-label-small">часов</div> 
                </div> 
                <div class="total-card"> 
                    <div class="total-label">Начисленная заработная плата</div> 
                    <div class="big-number" id="personalTotalSalary">0</div> 
                    <div class="total-label-small">рублей</div> 
                </div> 
            </div> 
        </div> 

        <!-- Общий график --> 
        <div id="general" class="tab-content"> 
            <div class="card"> 
                <h2 class="card-title"><i class="fas fa-calendar-alt"></i> Общий график смен</h2> 
                 
                <div id="employeeColors" class="legend"></div> 
                 
                <div class="legend"> 
                    <div class="color-item"> 
                        <div class="color-box" style="background:var(--day-shift);"></div> 
                        <span>Дневная смена</span> 
                    </div> 
                    <div class="color-item"> 
                        <div class="color-box" style="background:var(--night-shift);"></div> 
                        <span>Ночная смена</span> 
                    </div> 
                    <div class="color-item"> 
                        <div class="color-box" style="background:var(--custom-shift);"></div> 
                        <span>Индивидуальные часы</span> 
                    </div> 
                </div> 

                <div class="calendar-wrapper"> 
                    <div class="calendar"> 
                        <div class="calendar-header"> 
                            <div class="month-year"> 
                                <i class="fas fa-calendar-alt"></i> 
                                <span id="generalMonthYear"></span> 
                            </div> 
                            <div class="nav-buttons"> 
                                <button class="btn btn-outline" onclick="prevMonth(true)"> 
                                    <i class="fas fa-chevron-left"></i> Предыдущий 
                                </button> 
                                <button class="btn btn-outline" onclick="goToToday(true)"> 
                                    <i class="fas fa-calendar-day"></i> Сегодня 
                                </button> 
                                <button class="btn btn-outline" onclick="nextMonth(true)"> 
                                    Следующий <i class="fas fa-chevron-right"></i> 
                                </button> 
                            </div> 
                        </div> 
                        <div class="weekdays"> 
                            <div>Пн</div><div>Вт</div><div>Ср</div><div>Чт</div><div>Пт</div><div>Сб</div><div>Вс</div> 
                        </div> 
                        <div class="days" id="generalDays"></div> 
                    </div> 
                </div> 
            </div> 

            <div class="card"> 
                <h2 class="card-title"><i class="fas fa-chart-bar"></i> Итоги за месяц</h2> 
                <div class="employee-dashboard" id="employeeDashboard"></div> 
            </div> 
        </div> 

        <!-- Задачи --> 
        <div id="tasks" class="tab-content"> 
            <div class="card"> 
                <h2 class="card-title"><i class="fas fa-tasks"></i> Управление задачами</h2> 
                 
                <div class="form-row"> 
                    <div class="form-group"> 
                        <label class="form-label" for="taskEmployee">Сотрудник</label> 
                        <select id="taskEmployee" class="form-control"> 
                            <option value="">— Выберите сотрудника —</option> 
                        </select> 
                    </div> 
                    <div class="form-group"> 
                        <label class="form-label" for="taskDate">Дата</label> 
                        <input type="date" id="taskDate" class="form-control"> 
                    </div> 
                </div> 
                 
                <div class="form-row"> 
                    <div class="form-group" style="flex: 3;"> 
                        <label class="form-label" for="newTaskText">Текст задачи</label> 
                        <input type="text" id="newTaskText" class="form-control" placeholder="Опишите задачу подробно..."> 
                    </div> 
                    <div class="form-group d-flex align-center" style="align-self: flex-end;"> 
                        <button class="btn btn-success w-100" onclick="addTask()"> 
                            <i class="fas fa-plus"></i> Добавить задачу 
                        </button> 
                    </div> 
                </div> 
            </div> 

            <div class="card"> 
                <h2 class="card-title"><i class="fas fa-list-check"></i> Список задач</h2> 
                <div class="task-list" id="taskList"> 
                    <div class="text-center" style="padding: 40px; color: var(--text-muted);"> 
                        <i class="fas fa-clipboard-list" style="font-size: 3rem; margin-bottom: 16px; opacity: 0.5;"></i> 
                        <p>Выберите сотрудника и дату для просмотра задач</p> 
                    </div> 
                </div> 
            </div> 
        </div> 

        <!-- Настройки --> 
        <div id="settings" class="tab-content"> 
            <div class="card"> 
                <h2 class="card-title"><i class="fas fa-cog"></i> Настройки приложения</h2> 
                 
                <div class="form-group"> 
                    <label class="form-label">Экспорт данных</label> 
                    <div class="d-flex gap-10"> 
                        <button class="btn btn-outline" onclick="exportData()"> 
                            <i class="fas fa-file-export"></i> Экспорт в JSON 
                        </button> 
                        <button class="btn btn-outline" onclick="exportToCSV()"> 
                            <i class="fas fa-file-csv"></i> Экспорт в CSV 
                        </button> 
                    </div> 
                </div> 
                 
                <div class="form-group"> 
                    <label class="form-label">Импорт данных</label> 
                    <div class="d-flex gap-10"> 
                        <input type="file" id="importFile" class="form-control" accept=".json,.csv" style="flex: 1;"> 
                        <button class="btn btn-outline" onclick="importData()"> 
                            <i class="fas fa-file-import"></i> Импорт 
                        </button> 
                    </div> 
                </div> 
                 
                <div class="form-group"> 
                    <label class="form-label">Резервное копирование</label> 
                    <div class="d-flex gap-10"> 
                        <button class="btn btn-outline" onclick="createBackup()"> 
                            <i class="fas fa-save"></i> Создать резервную копию 
                        </button> 
                        <button class="btn btn-outline" onclick="restoreBackup()"> 
                            <i class="fas fa-history"></i> Восстановить из резервной копии 
                        </button> 
                    </div> 
                </div> 
                 
                <div class="form-group"> 
                    <label class="form-label">Очистка данных</label> 
                    <div class="alert alert-warning"> 
                        <i class="fas fa-exclamation-triangle"></i> 
                        <div> 
                            <strong>Внимание!</strong> Это действие удалит все данные. Восстановление невозможно. 
                        </div> 
                    </div> 
                    <button class="btn btn-danger" onclick="clearAllData()"> 
                        <i class="fas fa-trash-alt"></i> Очистить все данные 
                    </button> 
                </div> 
                 
                <div class="form-group"> 
                    <label class="form-label">Информация о приложении</label> 
                    <div class="alert alert-info"> 
                        <i class="fas fa-info-circle"></i> 
                        <div> 
                            <strong>WorkShift Manager v2.0</strong><br> 
                            Приложение для управления графиками смен и задачами сотрудников.<br> 
                            Все данные хранятся локально в вашем браузере. 
                        </div> 
                    </div> 
                </div> 
            </div> 
        </div> 
    </div> 

    <!-- Модальное окно детального отчёта --> 
    <div id="dayModal" class="modal"> 
        <div class="modal-content"> 
            <div class="modal-header"> 
                <h2 class="modal-title"> 
                    <i class="fas fa-calendar-day"></i> 
                    <span id="modalDateTitle"></span> 
                </h2> 
                <button class="close-modal" onclick="closeModal()">×</button> 
            </div> 
             
            <div class="modal-section"> 
                <h3><i class="fas fa-user-clock"></i> Смены в этот день</h3> 
                <div class="shift-list" id="modalShifts"></div> 
            </div> 
             
            <div class="modal-section"> 
                <h3><i class="fas fa-tasks"></i> Задачи и отчёты</h3> 
                <div class="task-list-modal" id="modalTasks"></div> 
            </div> 
             
            <div class="modal-section"> 
                <h3><i class="fas fa-chart-pie"></i> Статистика дня</h3> 
                <div id="modalStats"></div> 
            </div> 
             
            <div class="d-flex justify-center mt-30"> 
                <button class="btn btn-primary" onclick="closeModal()"> 
                    <i class="fas fa-times"></i> Закрыть 
                </button> 
            </div> 
        </div> 
    </div> 
    <!-- Модальное окно аутентификации -->
<div id="authModal" class="modal" style="display: flex;">
    <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header">
            <h2 class="modal-title">WorkShift Manager</h2>
        </div>
        <div class="card">
            <h3 id="authTitle">Вход в аккаунт</h3>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="authEmail" class="form-control" placeholder="igor@mail.ru">
            </div>
            <div class="form-group">
                <label>Пароль</label>
                <input type="password" id="authPassword" class="form-control" placeholder="минимум 6 символов">
            </div>
            <div class="d-flex gap-10">
                <button id="authSubmit" class="btn btn-primary w-100">Войти</button> <!-- УБРАЛИ onclick -->
            </div>
            <div class="text-center mt-20">
                <small>Нет аккаунта? <a href="#" id="toggleAuthLink">Регистрация</a></small> <!-- УБРАЛИ onclick, добавили id -->
            </div>
            <div id="authError" class="alert alert-danger mt-20 hidden"></div>
        </div>
    </div>
</div>

<!-- Основной контейнер приложения — спрячем до входа -->
<style>
    #mainApp { display: none; } /* Добавим этот стиль */
</style>
    <!-- Уведомления --> 
    <div id="notification" class="notification"> 
        <i class="fas fa-info-circle"></i> 
        <span id="notificationText"></span> 
    </div> 

    <script src="script.js"></script>  <!-- Ссылка на внешний JS -->
    <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js';
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js';
    import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js';
// Инициализация Firebase 
const firebaseConfig = {
  apiKey: "AIzaSyBpPiUaXXzPv21Tjr7vDs9R3SevZUNvNn0",
  authDomain: "workshift-manager-420e6.firebaseapp.com",
  projectId: "workshift-manager-420e6",
  storageBucket: "workshift-manager-420e6.firebasestorage.app",
  messagingSenderId: "205356609538",
  appId: "1:205356609538:web:6436a516f8c064dc48b71b"
};

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Глобальные переменные для script.js (чтобы loadData/saveData могли использовать)
    window.auth = auth;
    window.db = db;
    window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
    window.signInWithEmailAndPassword = signInWithEmailAndPassword;
    window.signOutAuth = signOut;
    window.doc = doc;
    window.getDoc = getDoc;
    window.setDoc = setDoc;
    window.serverTimestamp = serverTimestamp;

    let isRegisterMode = false;

    // Переключение режимов
    function toggleAuthMode(e) {
        e.preventDefault();
        isRegisterMode = !isRegisterMode;
        document.getElementById('authTitle').textContent = isRegisterMode ? 'Регистрация' : 'Вход в аккаунт';
        document.getElementById('authSubmit').textContent = isRegisterMode ? 'Зарегистрироваться' : 'Войти';
        document.getElementById('authError').classList.add('hidden');
    }

    // Обработка клика по кнопке
    async function handleAuth() {
        const email = document.getElementById('authEmail').value.trim();
        const password = document.getElementById('authPassword').value;
        const errorDiv = document.getElementById('authError');
        errorDiv.classList.add('hidden');
        errorDiv.textContent = '';

        if (!email || !password) {
            errorDiv.textContent = 'Заполните все поля';
            errorDiv.classList.remove('hidden');
            return;
        }

        if (!email.includes('@')) {
            errorDiv.textContent = 'Введите полный email (например, igor@mail.ru)';
            errorDiv.classList.remove('hidden');
            return;
        }

        try {
            if (isRegisterMode) {
                await createUserWithEmailAndPassword(auth, email, password);
                showNotification('Аккаунт создан!', 'success');
            } else {
                await signInWithEmailAndPassword(auth, email, password);
                showNotification('Добро пожаловать!', 'success');
            }
        } catch (error) {
            let message = 'Ошибка: ';
            switch (error.code) {
                case 'auth/email-already-in-use': message += 'Email уже используется'; break;
                case 'auth/invalid-email': message += 'Неверный email'; break;
                case 'auth/weak-password': message += 'Пароль слишком короткий (минимум 6 символов)'; break;
                case 'auth/user-not-found':
                case 'auth/wrong-password': message += 'Неверный email или пароль'; break;
                default: message += error.message || 'Попробуйте позже';
            }
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            console.error(error); // для дебага
        }
    }

    // Ждём полной загрузки DOM и добавляем обработчики
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initAuth);
    } else {
        initAuth();
    }

    function initAuth() {
        const submitBtn = document.getElementById('authSubmit');
        const toggleLink = document.getElementById('toggleAuthLink');
        if (submitBtn) submitBtn.addEventListener('click', handleAuth);
        if (toggleLink) toggleLink.addEventListener('click', toggleAuthMode);
    }

    // Мониторинг входа (главное!)
    onAuthStateChanged(auth, user => {
        if (user) {
            // Успешный вход
            document.getElementById('authModal').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';

            // Загружаем данные приложения (твоя функция из script.js)
            if (typeof loadData === 'function') {
                loadData();
            }

            // Кнопка выхода
            if (!document.querySelector('#logoutBtn')) {
                const header = document.querySelector('.header');
                if (header) {
                    const logoutBtn = document.createElement('button');
                    logoutBtn.id = 'logoutBtn';
                    logoutBtn.className = 'btn btn-outline';
                    logoutBtn.textContent = 'Выйти';
                    logoutBtn.addEventListener('click', () => {
                        signOutAuth(auth);
                        showNotification('Вы вышли из аккаунта', 'info');
                    });
                    header.appendChild(logoutBtn);
                }
            }

            setTimeout(() => showNotification('WorkShift Manager готов к работе!', 'success', 4000), 1000);
        } else {
            // Нет входа
            document.getElementById('authModal').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';

            const logoutBtn = document.querySelector('#logoutBtn');
            if (logoutBtn) logoutBtn.remove();
        }
    });
</script>
</body> 
</html>